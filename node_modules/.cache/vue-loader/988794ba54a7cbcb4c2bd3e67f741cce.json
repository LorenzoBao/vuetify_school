{"remainingRequest":"G:\\x\\vuetify_school\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\x\\vuetify_school\\src\\components\\HomeItem\\Table.vue?vue&type=style&index=0&id=f9df34be&scoped=true&lang=css&","dependencies":[{"path":"G:\\x\\vuetify_school\\src\\components\\HomeItem\\Table.vue","mtime":1619054010890},{"path":"G:\\x\\vuetify_school\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\x\\vuetify_school\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"G:\\x\\vuetify_school\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"G:\\x\\vuetify_school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\x\\vuetify_school\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmNvbHsNCiAgaGVpZ2h0OiA4MHB4Ow0KfQ0KI3R7DQogIGhlaWdodDogNTBweDsNCn0NCg=="},{"version":3,"sources":["Table.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAggBA;AACA;AACA;AACA;AACA;AACA","file":"Table.vue","sourceRoot":"src/components/HomeItem","sourcesContent":["<template>\r\n  <v-data-table\r\n      :headers=\"headers\"\r\n      :items=\"desserts\"\r\n      sort-by=\"calories\"\r\n      class=\"elevation-1\"\r\n      :loading=\"isLoading\"\r\n      loading-text=\"加载数据中\"\r\n      multi-sort\r\n      no-data-text=\"未查询到数据\"\r\n\r\n  >\r\n    <!--    show-group-by-->\r\n    <template v-slot:top>\r\n      <v-toolbar flat>\r\n\r\n        <v-toolbar-title>缺勤管理</v-toolbar-title>\r\n        <v-divider\r\n            class=\"mx-4\"\r\n            inset\r\n            vertical\r\n        ></v-divider>\r\n        <v-col cols=\"3\" id=\"t\">\r\n          <timePicker ref=\"times\"></timePicker>\r\n        </v-col>\r\n\r\n        <v-col  cols=\"2.7\">\r\n          <v-autocomplete\r\n              v-model=\"collegeValue\"\r\n              :items=\"collegeItem\"\r\n              :loading=\"isLoading\"\r\n              dense\r\n              filled\r\n              label=\"学院\"\r\n          ></v-autocomplete>\r\n        </v-col>\r\n        <v-col cols=\"2.7\">\r\n          <v-autocomplete\r\n              v-model=\"ClassValue\"\r\n              :items='ClassItem'\r\n              :loading=\"isLoading\"\r\n              dense\r\n              filled\r\n              label=\"班级\"\r\n              no-data-text=\"请选择学院\"\r\n          ></v-autocomplete>\r\n        </v-col>\r\n        <v-col cols=\"2.8\">\r\n          <v-autocomplete\r\n              v-model=\"StuValue\"\r\n              :items=\"StuItem\"\r\n              :loading=\"isLoading\"\r\n              dense\r\n              filled\r\n              label=\"学生\"\r\n              no-data-text=\"请选择班级\"\r\n          ></v-autocomplete>\r\n        </v-col>\r\n        <template >\r\n          <v-btn\r\n              color=\"primary\"\r\n              @click=\"exportTable()\"\r\n          >导出表格</v-btn>\r\n        </template>\r\n\r\n\r\n        <v-spacer></v-spacer>\r\n        <v-dialog\r\n            v-model=\"dialog\"\r\n            max-width=\"500px\"\r\n        >\r\n          <template v-slot:activator=\"{ on, attrs }\">\r\n            <v-btn\r\n                color=\"primary\"\r\n                dark\r\n                class=\"mb-2\"\r\n                v-bind=\"attrs\"\r\n                v-on=\"on\"\r\n            >\r\n              添加缺勤学生\r\n            </v-btn>\r\n          </template>\r\n\r\n          <v-card>\r\n            <v-card-title>\r\n              <span class=\"headline\">{{ formTitle }}</span>\r\n            </v-card-title>\r\n\r\n            <v-card-text>\r\n              <v-container>\r\n                <v-row>\r\n                  <v-col\r\n                      cols=\"12\"\r\n                      sm=\"6\"\r\n                      md=\"4\"\r\n                  >\r\n                    <v-text-field\r\n                        v-model=\"editedItem.time\"\r\n                        label=\"时间\"\r\n                    ></v-text-field>\r\n                  </v-col>\r\n                  <v-col\r\n                      cols=\"12\"\r\n                      sm=\"6\"\r\n                      md=\"4\"\r\n                  >\r\n                    <v-text-field\r\n                        v-model=\"editedItem.number\"\r\n                        label=\"学号\"\r\n                    ></v-text-field>\r\n                  </v-col>\r\n                  <v-col\r\n                      cols=\"12\"\r\n                      sm=\"6\"\r\n                      md=\"4\"\r\n                  >\r\n                    <v-text-field\r\n                        v-model=\"editedItem.name\"\r\n                        label=\"姓名\"\r\n                    ></v-text-field>\r\n                  </v-col>\r\n                  <v-col\r\n                      cols=\"12\"\r\n                      sm=\"6\"\r\n                      md=\"4\"\r\n                  >\r\n                    <v-text-field\r\n                        v-model=\"editedItem.course\"\r\n                        label=\"科目\"\r\n                    ></v-text-field>\r\n                  </v-col>\r\n                  <v-col\r\n                      cols=\"12\"\r\n                      sm=\"6\"\r\n                      md=\"4\"\r\n                  >\r\n                    <v-radio-group v-model=\"editedItem.LorT\">\r\n                      <v-radio value=\"迟到\" key=\"1\" label=\"迟到\"></v-radio>\r\n                      <v-radio value=\"旷课\" key=\"2\" label=\"旷课\"></v-radio>\r\n                      <v-radio value=\"早退\" key=\"3\" label=\"早退\"></v-radio>\r\n                    </v-radio-group>\r\n                  </v-col>\r\n                  <v-textarea\r\n                      v-model=\"editedItem.describe\"\r\n                      label=\"请添加描述\"\r\n                  ></v-textarea>\r\n                </v-row>\r\n              </v-container>\r\n            </v-card-text>\r\n\r\n            <v-card-actions>\r\n              <v-spacer></v-spacer>\r\n              <v-btn\r\n                  color=\"blue darken-1\"\r\n                  text\r\n                  @click=\"close\"\r\n              >\r\n                取消\r\n              </v-btn>\r\n              <v-btn\r\n                  color=\"blue darken-1\"\r\n                  text\r\n                  @click=\"save\"\r\n              >\r\n                保存\r\n              </v-btn>\r\n            </v-card-actions>\r\n          </v-card>\r\n        </v-dialog>\r\n        <v-dialog v-model=\"dialogDelete\" max-width=\"500px\">\r\n          <v-card>\r\n            <v-card-title class=\"headline\">确定要删除这个选项吗</v-card-title>\r\n            <v-card-actions>\r\n              <v-spacer></v-spacer>\r\n              <v-btn color=\"blue darken-1\" text @click=\"deleteItemConfirm\">确定</v-btn>\r\n              <v-btn color=\"blue darken-1\" text @click=\"closeDelete\">取消</v-btn>\r\n              <v-spacer></v-spacer>\r\n            </v-card-actions>\r\n          </v-card>\r\n        </v-dialog>\r\n      </v-toolbar>\r\n    </template>\r\n    <template v-slot:item.actions=\"{ item }\">\r\n      <v-icon\r\n          small\r\n          class=\"mr-2\"\r\n          @click=\"editItem(item)\"\r\n          color=\"green\"\r\n      >\r\n        mdi-pencil\r\n      </v-icon>\r\n      <v-icon\r\n          small\r\n          @click=\"deleteItem(item)\"\r\n          color=\"red\"\r\n      >\r\n        mdi-delete\r\n      </v-icon>\r\n    </template>\r\n    <!--    <template>-->\r\n    <!--      <v-btn-->\r\n    <!--          color=\"red\"-->\r\n    <!--          @click=\"initialize\"-->\r\n    <!--      >-->\r\n    <!--        Reset-->\r\n    <!--      </v-btn>-->\r\n    <!--    </template>-->\r\n  </v-data-table>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  addStuFromApi,\r\n  deleteStuFromApi,\r\n  getClassFromApi,\r\n  getClassTableFromApi,\r\n  getStuFromApi,\r\n  getStuTableFromApi,\r\n  updateStuFromApi,\r\n  getcollegeFromApi, exportTableFromApi\r\n} from \"../../netwoek/API\";\r\nimport timePicker from \"../timeData/timePicker\";\r\n\r\n\r\nexport default {\r\n\r\n  name: \"Table\",\r\n\r\n  data: () => ({\r\n\r\n    collegeItem:['加载中'],\r\n    ClassItem:['请选择学院'],\r\n    StuItem:['请选择班级'],\r\n    ClassIdName:{},\r\n    StuIdName:{},\r\n    collegeItemName:{},\r\n    schoolYearValue:null,\r\n    collegeValue: null,\r\n    ClassValue:null,\r\n    StuValue:null,\r\n    isLoading:false,\r\n    dialog: false,\r\n    dialogDelete: false,\r\n    deleteAPI:null,\r\n    editAPI:null,\r\n    headers: [\r\n      { text: '时间',align: 'start', value: 'time',width:250},\r\n      { text: '学号', value: 'number' },\r\n      { text: '姓名', value: 'name' },\r\n      { text: '科目', value: 'course' },\r\n      { text: '事件', value: 'LorT',},\r\n      { text: '描述', value: 'describe', sortable: false },\r\n      { text: '操作', value: 'actions', sortable: false },\r\n    ],\r\n    desserts: [      ],\r\n\r\n    editedIndex: -1,\r\n    editedItem: {\r\n      time: null,\r\n      number: null,\r\n      name: null,\r\n      course: null,\r\n      LorT: null,\r\n      describe:null\r\n    },\r\n    addItem: {\r\n      time: null,\r\n      number: null,\r\n      name: null,\r\n      course: null,\r\n      LorT: null,\r\n      describe:null\r\n    },\r\n    defaultItem: {\r\n      time: null,\r\n      number: null,\r\n      name: null,\r\n      course: null,\r\n      LorT: null,\r\n      describe:null\r\n    },\r\n  }),\r\n\r\n  computed: {\r\n    formTitle () {\r\n      return this.editedIndex === -1 ? '新增学生信息' : '编辑学生信息'\r\n    },\r\n\r\n  },\r\n\r\n  watch: {\r\n\r\n    dialog (val) {\r\n      val || this.close()\r\n    },\r\n    dialogDelete (val) {\r\n      val || this.closeDelete()\r\n    },\r\n\r\n\r\n    collegeValue(val){\r\n      console.log(val);\r\n      this.isLoading=true\r\n      // this.ClassItem=null\r\n      val=this.collegeItemName[val]\r\n      getClassFromApi(val)\r\n          .then(res=>{\r\n            this.StuItem=[]\r\n            this.ClassItem=[]\r\n            for(let i=0;i<res.data.list.length;i++) {\r\n              this.$set(this.ClassItem, i, res.data.list[i].name)\r\n              this.ClassIdName[res.data.list[i].name]=res.data.list[i].pid\r\n\r\n            }\r\n            this.isLoading = false\r\n          })\r\n          .catch(err=>{this.ClassItem=['未查询到数据'];this.isLoading=false})\r\n\r\n    },\r\n    ClassValue(val){\r\n      let pid=this.ClassIdName[val]\r\n      // this.StuIdName=''\r\n      // this.StuItem=''\r\n      this.isLoading=true\r\n\r\n      getStuFromApi(this.ClassIdName[val])\r\n          .then(res=>{\r\n            this.StuItem=[]\r\n            for(let i=0;i<res.data.list.length;i++) {\r\n              if(res.data.list[i].pid===this.ClassIdName[val]){\r\n                this.$set(this.StuItem, i, res.data.list[i].name)\r\n                this.StuIdName[res.data.list[i].name]=res.data.list[i].sid\r\n              }\r\n\r\n            }\r\n            this.isLoading=false\r\n          })\r\n          .catch(err=>{this.StuItem=['未查询到数据'];this.isLoading=false})\r\n\r\n      getClassTableFromApi(pid,this.$refs.times.dates[0],this.$refs.times.dates[1])\r\n          .then(res=>{\r\n\r\n            this.desserts=[]\r\n            for(let i=0;i<res.data.list.length;i++) {\r\n              for(let j=0;j<res.data.list[i].absentDetailsList.length;j++){\r\n                this.addItem['time']=res.data.list[i].absentDetailsList[j].createDate\r\n                this.addItem['number']=res.data.list[i].absentDetailsList[j].sid\r\n                this.addItem['course']=res.data.list[i].absentDetailsList[j].course\r\n                this.addItem['name']=res.data.list[i].name\r\n                this.addItem['LorT']=res.data.list[i].absentDetailsList[j].reason\r\n                this.addItem['describe']=res.data.list[i].absentDetailsList[j].remarks\r\n                this.desserts.push(this.addItem);\r\n              }\r\n            }\r\n\r\n            // this.$set(this.desserts, i, res.data.list[i].name)\r\n            // this.ClassIdName[res.data.list[i].name]=res.data.list[i].pid\r\n\r\n            this.isLoading=false\r\n          })\r\n          .catch(err=>{\r\n            alert('未查询到数据')\r\n            this.isLoading=false\r\n          })\r\n    },\r\n\r\n\r\n    StuValue(val){\r\n      console.log(val);\r\n      let sid=this.StuIdName[val]\r\n      this.isLoading=true\r\n      this.desserts=[]\r\n\r\n      getStuTableFromApi(sid,this.$refs.times.dates[0],this.$refs.times.dates[1])\r\n          .then(res=>{\r\n            for(let i=0;i<res.data.list.length;i++) {\r\n              this.addItem['time']=res.data.list[i].createDate\r\n              this.addItem['number']=res.data.list[i].sid\r\n              this.addItem['course']=res.data.list[i].course\r\n              this.addItem['name']=res.data.list[i].name\r\n              this.addItem['LorT']=res.data.list[i].reason\r\n              this.addItem['describe']=res.data.list[i].remarks\r\n\r\n              this.desserts.push(this.addItem);\r\n            }\r\n            this.isLoading=false\r\n          })\r\n          .catch(err=>{this.desserts=['未查询到数据'];this.isLoading=false})\r\n\r\n    }\r\n\r\n\r\n  },\r\n\r\n  created() {\r\n\r\n\r\n\r\n    getcollegeFromApi(this.$store.state.token)\r\n        .then(res=>{\r\n          for(let i=0;i<res.data.list.length;i++){\r\n            this.$set(this.collegeItem,i,res.data.list[i].name)\r\n            this.collegeItemName[res.data.list[i].name]=res.data.list[i].cid\r\n          }\r\n        })\r\n        .catch(err=>{alert('加载失败请刷新页面')})\r\n\r\n  },\r\n\r\n  methods: {\r\n    exportTable(){\r\n      let val\r\n      let ID\r\n      this.StuValue?val='student':val='class'\r\n      this.StuValue?ID=this.StuIdName[this.StuValue]:ID=this.ClassIdName[this.ClassValue]\r\n      exportTableFromApi(val,this.$refs.times.dates[0],this.$refs.times.dates[1],ID)\r\n      .then((res) => {\r\n        console.log('res', res);\r\n        const blob = res.data;\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(blob);\r\n        reader.onload = (e) => {\r\n          const a = document.createElement('a');\r\n          a.download = `文件名称.zip`;\r\n          // 后端设置的文件名称在res.headers的 \"content-disposition\": \"form-data; name=\\\"attachment\\\"; filename=\\\"20181211191944.zip\\\"\",\r\n          a.href = e.target.result;\r\n          document.body.appendChild(a);\r\n          a.click();\r\n          document.body.removeChild(a);\r\n        };\r\n      })\r\n\r\n    },\r\n\r\n    editItem (item) {\r\n      this.editedIndex = this.desserts.indexOf(item)\r\n      this.editedItem = Object.assign({}, item)\r\n      this.dialog = true\r\n      this.editAPI=item\r\n    },\r\n\r\n    deleteItem (item) {\r\n      this.editedIndex = this.desserts.indexOf(item)\r\n      this.editedItem = Object.assign({}, item)\r\n      this.dialogDelete = true\r\n      this.deleteAPI=item\r\n\r\n    },\r\n\r\n    deleteItemConfirm () {\r\n      deleteStuFromApi(this.deleteAPI.number)\r\n          .then(res=>{\r\n            this.desserts.splice(this.editedIndex, 1)\r\n            this.closeDelete()\r\n          })\r\n          .catch(alert('删除失败'))\r\n\r\n    },\r\n\r\n    close () {\r\n\r\n      this.dialog = false\r\n      this.$nextTick(() => {\r\n        this.editedItem = Object.assign({}, this.defaultItem)\r\n        this.editedIndex = -1\r\n      })\r\n    },\r\n\r\n    closeDelete () {\r\n      this.dialogDelete = false\r\n      this.$nextTick(() => {\r\n        this.editedItem = Object.assign({}, this.defaultItem)\r\n        this.editedIndex = -1\r\n      })\r\n    },\r\n\r\n    save () {\r\n      if (this.editedIndex > -1) {\r\n        if(this.editedItem.course&&this.editedItem.name&&this.editedItem.time&&this.editedItem.number){\r\n\r\n          updateStuFromApi(this.editedItem)\r\n              .then(res=>{ Object.assign(this.desserts[this.editedIndex], this.editedItem)})\r\n              .catch(alert('修改失败'))\r\n        }else{\r\n          alert('请输入完整')\r\n        }\r\n      } else {\r\n        if(this.editedItem.course&&this.editedItem.name&&this.editedItem.time&&this.editedItem.number){\r\n          addStuFromApi(this.editedItem)\r\n              .then(res=>{ this.desserts.push(this.editedItem);this.close() })\r\n\r\n              .catch(alert('添加失败'))\r\n        }else{\r\n          alert('请输入完整')\r\n        }\r\n      }\r\n\r\n\r\n    },\r\n\r\n\r\n\r\n\r\n\r\n  },\r\n  components:{\r\n    timePicker\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.col{\r\n  height: 80px;\r\n}\r\n#t{\r\n  height: 50px;\r\n}\r\n</style>"]}]}